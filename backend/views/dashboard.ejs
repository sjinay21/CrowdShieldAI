<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><%= title %></title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.socket.io/4.7.4/socket.io.min.js"></script>
    <style>
        body { 
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
        }
        .glass-card {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .pulse-dot {
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        .severity-critical { border-left: 4px solid #ef4444; }
        .severity-high { border-left: 4px solid #f97316; }
        .severity-medium { border-left: 4px solid #eab308; }
        .severity-low { border-left: 4px solid #22c55e; }
    </style>
</head>
<body class="text-white min-h-screen">
    <div class="container mx-auto px-4 py-8">
        <!-- Header -->
        <div class="flex justify-between items-center mb-8">
            <div>
                <h1 class="text-4xl font-bold mb-2">
                    ðŸ”’ CCTV Surveillance Control Center
                </h1>
                <p class="text-slate-300">Real-time monitoring and threat detection</p>
            </div>
            <div class="flex items-center space-x-4">
                <div class="glass-card px-4 py-2 rounded-lg">
                    <div class="flex items-center space-x-2">
                        <div class="w-3 h-3 bg-green-500 rounded-full pulse-dot"></div>
                        <span class="text-sm">System Online</span>
                    </div>
                </div>
                <div class="glass-card px-4 py-2 rounded-lg">
                    <span class="text-sm" id="currentTime"></span>
                </div>
            </div>
        </div>

        <!-- Stats Cards -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
            <div class="glass-card p-6 rounded-xl">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-slate-400 text-sm">Total Events</p>
                        <p class="text-3xl font-bold text-blue-400"><%= stats.totalEvents %></p>
                    </div>
                    <div class="w-12 h-12 bg-blue-500/20 rounded-lg flex items-center justify-center">
                        <svg class="w-6 h-6 text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                        </svg>
                    </div>
                </div>
            </div>
            
            <div class="glass-card p-6 rounded-xl">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-slate-400 text-sm">Active Alerts</p>
                        <p class="text-3xl font-bold text-amber-400"><%= stats.activeEvents %></p>
                    </div>
                    <div class="w-12 h-12 bg-amber-500/20 rounded-lg flex items-center justify-center">
                        <svg class="w-6 h-6 text-amber-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"></path>
                        </svg>
                    </div>
                </div>
            </div>
            
            <div class="glass-card p-6 rounded-xl">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-slate-400 text-sm">Critical Events</p>
                        <p class="text-3xl font-bold text-red-400"><%= stats.criticalEvents %></p>
                    </div>
                    <div class="w-12 h-12 bg-red-500/20 rounded-lg flex items-center justify-center">
                        <svg class="w-6 h-6 text-red-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                    </div>
                </div>
            </div>
        </div>

        <!-- Recent Events -->
        <div class="glass-card rounded-xl p-6 mb-8">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold">Recent Security Events</h2>
                <div class="flex items-center space-x-2">
                    <div class="w-2 h-2 bg-green-500 rounded-full pulse-dot"></div>
                    <span class="text-sm text-slate-400">Live Updates</span>
                </div>
            </div>
            
            <div class="space-y-4" id="eventsContainer">
                <% recentEvents.forEach(event => { %>
                    <div class="severity-<%= event.severity %> glass-card p-4 rounded-lg">
                        <div class="flex justify-between items-start mb-2">
                            <div>
                                <h3 class="font-semibold text-lg capitalize">
                                    <%= event.action.replace(/_/g, ' ') %>
                                </h3>
                                <p class="text-slate-300 text-sm"><%= event.description %></p>
                            </div>
                            <div class="text-right">
                                <span class="inline-block px-2 py-1 text-xs rounded-full bg-<%= event.severity === 'critical' ? 'red' : event.severity === 'high' ? 'orange' : event.severity === 'medium' ? 'yellow' : 'green' %>-500/20 text-<%= event.severity === 'critical' ? 'red' : event.severity === 'high' ? 'orange' : event.severity === 'medium' ? 'yellow' : 'green' %>-400">
                                    <%= event.severity.toUpperCase() %>
                                </span>
                            </div>
                        </div>
                        <div class="flex justify-between items-center text-sm text-slate-400">
                            <span>ðŸ“¹ <%= event.camera_id %> â€¢ <%= event.location %></span>
                            <span><%= new Date(event.timestamp).toLocaleString() %></span>
                        </div>
                    </div>
                <% }); %>
            </div>
        </div>

        <!-- Camera Status -->
        <div class="glass-card rounded-xl p-6">
            <h2 class="text-2xl font-bold mb-6">Camera Network Status</h2>
            <div class="grid grid-cols-1 md:grid-cols-3 lg:grid-cols-5 gap-4" id="cameraStatus">
                <!-- Camera status will be populated by JavaScript -->
            </div>
        </div>
    </div>

    <script>
        // Initialize Socket.IO
        const socket = io();
        
        // Update current time
        function updateTime() {
            document.getElementById('currentTime').textContent = new Date().toLocaleTimeString();
        }
        setInterval(updateTime, 1000);
        updateTime();

        // Listen for new events
        socket.on('new_event', (event) => {
            addEventToList(event);
        });

        function addEventToList(event) {
            const container = document.getElementById('eventsContainer');
            const eventDiv = document.createElement('div');
            eventDiv.className = `severity-${event.severity} glass-card p-4 rounded-lg`;
            eventDiv.style.animation = 'slideIn 0.5s ease-out';
            
            const severityColor = {
                'critical': 'red',
                'high': 'orange', 
                'medium': 'yellow',
                'low': 'green'
            }[event.severity];
            
            eventDiv.innerHTML = `
                <div class="flex justify-between items-start mb-2">
                    <div>
                        <h3 class="font-semibold text-lg capitalize">
                            ${event.action.replace(/_/g, ' ')}
                        </h3>
                        <p class="text-slate-300 text-sm">${event.description}</p>
                    </div>
                    <div class="text-right">
                        <span class="inline-block px-2 py-1 text-xs rounded-full bg-${severityColor}-500/20 text-${severityColor}-400">
                            ${event.severity.toUpperCase()}
                        </span>
                    </div>
                </div>
                <div class="flex justify-between items-center text-sm text-slate-400">
                    <span>ðŸ“¹ ${event.camera_id} â€¢ ${event.location}</span>
                    <span>${new Date(event.timestamp).toLocaleString()}</span>
                </div>
            `;
            
            container.insertBefore(eventDiv, container.firstChild);
            
            // Remove oldest event if more than 10
            if (container.children.length > 10) {
                container.removeChild(container.lastChild);
            }
        }

        // Simulate camera status updates
        function updateCameraStatus() {
            const cameras = [
                { id: 'CAM001', location: 'Main Entrance', status: 'online' },
                { id: 'CAM002', location: 'Parking Lot', status: 'online' },
                { id: 'CAM003', location: 'Warehouse Floor', status: 'online' },
                { id: 'CAM004', location: 'Server Room', status: 'offline' },
                { id: 'CAM005', location: 'Emergency Exit', status: 'online' }
            ];
            
            const container = document.getElementById('cameraStatus');
            container.innerHTML = cameras.map(camera => `
                <div class="glass-card p-4 rounded-lg text-center">
                    <div class="w-12 h-12 mx-auto mb-2 bg-slate-600 rounded-lg flex items-center justify-center">
                        <svg class="w-6 h-6 text-slate-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"></path>
                        </svg>
                    </div>
                    <p class="font-semibold text-sm">${camera.id}</p>
                    <p class="text-xs text-slate-400 mb-2">${camera.location}</p>
                    <div class="flex items-center justify-center space-x-1">
                        <div class="w-2 h-2 rounded-full ${camera.status === 'online' ? 'bg-green-500' : 'bg-red-500'}"></div>
                        <span class="text-xs ${camera.status === 'online' ? 'text-green-400' : 'text-red-400'}">${camera.status}</span>
                    </div>
                </div>
            `).join('');
        }

        updateCameraStatus();
        setInterval(updateCameraStatus, 30000); // Update every 30 seconds

        // Add CSS animation
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideIn {
                from {
                    opacity: 0;
                    transform: translateX(-20px);
                }
                to {
                    opacity: 1;
                    transform: translateX(0);
                }
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html>